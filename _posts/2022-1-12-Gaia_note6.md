---
layout: post
title: "Gaia笔记5——CJ版本更新"
date: 2021-7-2
categories: UE4
tags: gaia
excerpt: 做的各种功能
author: Tizeng
published: true
---

* content
{:toc}

## UI框架（2022.1.12）

之前任由ui逻辑自行发展，出现了很多难以解决的问题，如交互按钮与菜单重合、要隐藏hud时不能一键处理，某些外部创建的ui如任务追踪，hud并不能拿到其实例，造成不知如何去隐藏它的窘境，必须立刻规范ui的创建和管理流程，理清思路。

首先将ui按层级区分，

WidgetTree

### 调用其他Plugin

类声明前面要加插件名+`_API`的宏
build.cs
.plugin
static变量要在cpp重新定义

### Bug

* 明明将RootWidget加到Viewport上了，并且将新创建的ui加进了Overlay的Slot，但是看不到任何东西，后来得知是一个UserWidget自己必须也有一个类似Root的控件，然后把其他ui放进去，通过重写`RebuildWidget`方法，创建一个SOverlay作为Root，再把创建好的层级进去，就能正常显示了。
* 底层的ui居然会盖在上层的ui上面，多天的debug和求助之后发现是之前创建ui的地方遗留了一个将所创建ui加到Viewport上的代码，而此时我们其实希望它在Manager所管理的RootWidget上。
* gc问题导致崩溃：Manager中的RootWidget在AddToViewport之后，会在场景切换的时候被清除，但是Manager并不会，因此当Manager重新初始化创建RootWidget的时候需要进行判断，如果之前存的指针内容有效（`IsValidLowLevel`），则需要RemoveFromParent并告诉引擎将其回收（`MarkPendingKill`）。
