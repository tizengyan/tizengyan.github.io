---
layout: post
title: "Gaia笔记7——Gameplay"
date: 2022-4-29
categories: UE4
tags: gaia
excerpt: 一些Gameplay的功能模块
author: Tizeng
published: false
---

* content
{:toc}


## 辅助瞄准优化（2022.4.13）

增加开枪时准心往附近npc移动的功能

## 3D路径显示（2022.4.21）

NavMesh得到路径
（寻路实现）
生成indicator，调整indicator方向
路径更新优化、维护
LineTrace得到正确Z坐标

验收的时候遇到进入切换后的关卡中NavMesh消失拿不到路径的问题，正常打开没问题，从别的关卡切进去就会消失，最后发现是单机进地图NavMesh消失。

## 开枪流程（2022.4.29）

1. inputid通知控制人物状态的StateComponent，执行开枪GA（ActivateAbility）
2. GA执行开枪逻辑并广播事件，同时角色Actor设定开枪延迟Timer
3. Timer到时间角色Actor通知武器Actor开枪
4. 武器Actor身上处理开火的组件FireComponent创建子弹Projectile，子弹身上的移动组件驱动其运动并检测碰撞
5. 角色Actor判断是否继续开枪，如果不是则停止开枪，终止开枪GA（EndAbility）

开枪的GA是众多FSMGA中的一个

单发连发靠DT中的一个配置来区分

### 子弹创建的位置



## 伤害流程（2022.5.1）

1. 生成的子弹实例Actor经过碰撞检测后，在PlayerController的待处理子弹队列中加入碰撞信息
2. PlayerController每隔一段时间检测是否有需要处理的子弹信息，如果有则对目标Actor上一个伤害GE
3. 伤害GE事先配置在角色Actor上，GE上配置的ExecutionCalculation会处理具体的伤害公式，其中可能用到从玩家或NPC身上capture到的属性，也会有一些通过`SetSetByCallerMagnitude`设置的用标签映射的值

## 地图切换（2022.5.13）

## 角色状态机（2022.5.20）

角色的状态切换通过一个Component来管理，每个状态都是一个GA，先将所有的状态GA定义好，然后在Component中用枚举在TMap中一一映射，需要激活的时候直接用对应的枚举去找即可。

有两套标签，一套用来处理本地的状态变化，一套用来在服务器中向其他客户端同步

## 开枪后坐力（2022.5.27）

开火状态通过开火按钮按下与放开进行设置，在开火状态中如果是连发武器则会根据其射速设置timer使其连续射击，值得注意的是武器上处理开火的Component有一个连发计数，开火时计数，停止开火后经过短暂的延迟会将其清零，如果在延迟时间内再次开火则继续计数，所以停止开火后要记录一个时间，下次开火时拿当前时间与其比较决定是否继续计数。

后坐力有一个单独的RecoilComponent处理，当前的连发计数是后坐力计算公式中的一个因子，计算完毕后会将水平、垂直方向的偏移值记录在一个成员变量中，然后根据表格中配置的后坐力生效时间，在Tick中
